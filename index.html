<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Prototype Dashboard of the TOP 3 Cybersecurity Patterns">
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="no-referrer">
    
    <title>(Prototype) Dashboard of the TOP 3 Cybersecurity Patterns</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .pattern-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .pattern-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .pattern-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 12px;
        }
        
        /* Consistent color scheme for patterns */
        .pattern-1 .pattern-dot { background-color: #ff6b6b; }
        .pattern-2 .pattern-dot { background-color: #ffd93d; }
        .pattern-3 .pattern-dot { background-color: #4da6ff; }
        
        .pattern-name {
            font-weight: 600;
            color: white;
        }
        
        .pattern-desc {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
        }
        
        .filters {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .filters h3 {
            margin-bottom: 20px;
            color: #1f2937;
            font-weight: 600;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .filter-input, .filter-select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .reset-button {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        
        .reset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
         .metric-red { border-left: 4px solid #e74c3c; }
        .metric-green { border-left: 4px solid #27ae60; }
        .metric-yellow { border-left: 4px solid #f39c12; }
        .metric-blue { border-left: 4px solid #3498db; }
        
        .metric-label {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-sub {
            font-size: 1.0rem;
            opacity: 0.8;
        }
        
        .metric-icon {
            font-size: 2.5rem;
            opacity: 0.8;
        }
        
        .nav-tabs {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .nav-tab {
            background: transparent;
            border: 2px solid #e5e7eb;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }
        
        .nav-tab:not(.active):hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 20px;
        }
        
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            min-height: 580px;
        }
        
        .chart-container canvas {
            height: 500px !important;
        }
        
        .chart-container h3 {
            margin-bottom: 20px;
            color: #1f2937;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            max-height: 600px;
            overflow-y: auto;
            width: 100%;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            table-layout: fixed;
        }
        
        .data-table th {
            background: #f9fafb;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .data-table tbody tr:hover {
            background: #f9fafb;
        }
        
        .pattern-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        /* Consistent badge colors matching pie chart */
        .badge-red { background: #ffebee; color: #ff6b6b; }
        .badge-yellow { background: #fff9e6; color: #ffd93d; }
        .badge-blue { background: #e3f2fd; color: #4da6ff; }
        
        .org-cell {
            font-weight: 600;
            color: #1f2937;
            min-width: 150px;
        }
        
        .stage-cell {
            font-weight: 500;
            color: #374151;
            min-width: 120px;
        }
        
        .event-cell {
            color: #4b5563;
            line-height: 1.5;
            min-width: 800px;
            max-width: 800px;
            white-space: normal;
            word-wrap: break-word;
            padding: 12px 10px;
        }
        
        .risk-cell {
            color: #6b7280;
            line-height: 1.5;
            min-width: 700px;
            max-width: 700px;
            white-space: normal;
            word-wrap: break-word;
            padding: 12px 10px;
        }
        
        
        .footer {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            color: #6b7280;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <h1>(Prototype) Dashboard of the TOP 3 Cybersecurity Patterns</h1>
            <p>Analyzed using Crime Script Analysis and Situational Crime Prevention</p>
            <div class="pattern-summary" id="patternSummary">
                <!-- Pattern items will be dynamically generated -->
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <h3>Analysis Filters</h3>
            <div class="filters-grid">
                <div class="filter-group">
                    <label>APQC PCF ID</label>
                    <select id="apqcFilter" class="filter-select">
                        <option value="all">All APQC PCF IDs</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Crime Script Stage</label>
                    <select id="stageFilter" class="filter-select">
                        <option value="all">All Stages</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ISO/IEC 27002:2022 Control</label>
                    <select id="isoFilter" class="filter-select">
                        <option value="all">All ISO Controls</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>SCP Technique</label>
                    <select id="scpFilter" class="filter-select">
                        <option value="all">All SCP Techniques</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button id="resetFilters" class="reset-button">Reset All Filters</button>
                </div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="metrics">
            <div class="metric-card metric-red">
                <div>
                    <div class="metric-label">Total Security Records</div>
                    <div class="metric-value" id="totalIncidents">0</div>
                    <div class="metric-sub">analyzed records</div>
                </div>
            </div>
            <div class="metric-card metric-green">
                <div>
                    <div class="metric-label">Affected Organizations</div>
                    <div class="metric-value" id="totalOrgs">0</div>
                    <div class="metric-sub">unique entities</div>
                </div>
            </div>
            <div class="metric-card metric-yellow">
                <div>
                    <div class="metric-label">Entry Stage Incidents</div>
                    <div class="metric-value" id="entryStageCount">0</div>
                    <div class="metric-sub" id="entryStagePercent">0% of total</div>
                </div>
            </div>
            <div class="metric-card metric-blue">
                <div>
                    <div class="metric-label">Primary Pattern</div>
                    <div class="metric-value" id="primaryPatternName">N/A</div>
                    <div class="metric-sub" id="primaryPatternCount">0 cases (0%)</div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs" id="navTabs">
            <!-- Navigation tabs will be dynamically generated -->
        </div>

        <!-- Overview Content -->
        <div id="overviewContent" class="content">
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>Pattern Distribution</h3>
                    <canvas id="patternsChart" width="400" height="350"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Crime Script Stages</h3>
                    <canvas id="stagesChart" width="400" height="350"></canvas>
                </div>
                <div class="chart-container">
                    <h3>ISO/IEC 27002:2022 Organizational Controls</h3>
                    <canvas id="isoChart" width="400" height="350"></canvas>
                </div>
                <div class="chart-container">
                    <h3>APQC PCF Process ID (level 3 - Process)</h3>
                    <canvas id="apqcChart" width="400" height="350"></canvas>
                </div>
            </div>
        </div>

        <!-- Dynamic pattern content sections will be inserted here -->
        <div id="patternContents">
            <!-- Pattern content sections will be dynamically generated -->
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><strong>Dashboard based on Crime Script Analysis and Situational Crime Prevention applied to cybersecurity incidents</strong></p>
            <p>Data source: Singapore Personal Data Protection Commission (2021-2024)</p>
            <p>Generated on: <span id="generatedDate"></span></p>
        </div>
    </div>

    <script>
        'use strict';
        
        // Security: Object.freeze to prevent modification of critical data
        const PATTERN_COLORS = Object.freeze({
            'Access Control Failures': { color: '#ff6b6b', desc: 'Inadequate access control implementation' },
            'Authentication Deficiencies': { color: '#ffd93d', desc: 'Authentication information protection failures' },
            'Supplier Management Risks': { color: '#4da6ff', desc: 'Third-party cybersecurity management gaps' }
        });
        
        // Security: Sanitize HTML function
        function sanitizeHTML(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }
        
        // Security: Validate and sanitize data
        function validateData(data) {
            if (!Array.isArray(data)) {
                console.error('Invalid data format: expected array');
                return [];
            }
            
            return data.map(item => {
                const sanitizedItem = {};
                for (const [key, value] of Object.entries(item)) {
                    // Sanitize all string values
                    sanitizedItem[key] = typeof value === 'string' ? sanitizeHTML(value) : value;
                }
                return sanitizedItem;
            });
        }
        
        // Data from Python
        const rawData = [
  {
    "SN": 1,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "Academy of Medicine Singpoare",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "The Commission analysis of the Leaked Data by the threat actor found that it had contained approximately 12.7GB of data from the Organisation. It was observed that bank account details and credit card numbers with CVV and expiry dates had been stored in clear text without password protection or current standard file encryption. ",
    "Crime development process stage description generated by the model": "The attacker exfiltrated personal and financial data, which was subsequently posted on the dark web.",
    "Risk identified from Decision document": "Failure to have reasonable access control, in response to the need to enhance access control to the type of financial information in its possession or under its control. This financial information had included credit card numbers with their security codes (CVVs). These had been stored in servers in plain text without password protection. Given the risk of harm due to the nature of this personal data, the Organisation could have considered additional security options to enhance access controls to protect this data. ",
    "Risk identified by the model": "Did not have separate access control for critical data.",
    "pattern": "Access Control Failures"
  },
  {
    "SN": 2,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "Budget Car",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "The delivery tracking function (the Tracking Function Page) on the website of Budgetcars Pte Ltd (the Organisation) could be used to gain access to the personal data belonging to another individual. By changing a few digits of a Tracking ID, the complainant could access the personal data of another individual (the Incident). ",
    "Crime development process stage description generated by the model": "The attacker gained access to personal data by exploiting a vulnerability in the delivery tracking function on Budgetcars Pte Ltd's website. By altering a few digits of a Tracking ID, unauthorized access to personal data was achieved.",
    "Risk identified from Decision document": "The Organisation failed to have reasonable access control to the affected individuals personal data when it simply adopted Tracking IDs generated by the Retailers without factoring in this risk. ",
    "Risk identified by the model": "the absence of enforced logical access controls around the delivery-tracking function",
    "pattern": "Access Control Failures"
  },
  {
    "SN": 3,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "CH Offshore",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "Investigations found that there were suspicious virtual private network (VPN) connections over Remote Desktop Protocol at the time of the Incident, suggesting that the Threat Actor likely gained access to the Organisations network using two VPN accounts that belonged to an employee and its outsourced IT vendor respectively. ",
    "Crime development process stage description generated by the model": "The Threat Actor gained access to the Organization's network using VPN accounts belonging to an employee and an outsourced IT vendor. ",
    "Risk identified from Decision document": "Employees were given local administrator rights on their. Its Firewall firmware was not patched since December 2021. It did not implement multi-factor authentication forremote access VPN logins.",
    "Risk identified by the model": "The Organization's failure to enforce strong access control policies, such as MFA, reflects a governance failure in implementing adequate security measures. The lack of oversight over the IT vendor and outdated audit practices contributed to the persistence of these vulnerabilities.",
    "pattern": "Access Control Failures"
  },
  {
    "SN": 4,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "North London Collegiate School",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "The Organisation admitted that it had only relied on a Robots.txt file deployed on its Website to instruct search engines to refrain from indexing the documents in the website directory folder. However, it is well established that the robots exclusion protocol is not mandatory, in the sense that it relies on compliance of  web crawlers without an enforcement mechanism.",
    "Crime development process stage description generated by the model": "The attacker gained access to the student reports through public search engines due to improper security configurations.",
    "Risk identified from Decision document": "Did not implement proper directory perimissions and access controls to prevent unintended access by web crawlers.",
    "Risk identified by the model": "The organization failed to implement robust security measures to protect sensitive data. There was a lack of comprehensive data protection policies and oversight, leading to reliance on inadequate security practices.",
    "pattern": "Access Control Failures"
  },
  {
    "SN": 5,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "PINC Interactive",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "Unauthorised access may have occurred from May 2019 to October 2019 when the Organisation did not require authentication for the Application Programming Interface (API) under testing (Staging API), which pointed to the Staging Database containing the personal data of real users, despite the Staging Database being accessible over the Internet. ",
    "Crime development process stage description generated by the model": "Unauthorized access to the Staging Database occurred due to the absence of authentication requirements for the Staging API, which was accessible over the Internet.",
    "Risk identified from Decision document": "There was no authentication for the Application Programming Interface directing to database.",
    "Risk identified by the model": "The organization's failure to enforce authentication for the Staging API reflects a significant policy deficiency. This gap in security policy allowed developers to prioritize convenience over security, leading to the exposure of sensitive data.",
    "pattern": "Access Control Failures"
  },
  {
    "SN": 6,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "Payroll2U",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "A single compromised account used for Remote Desktop Protocol (RDP) access to five servers on the Organisations AWS environment. Once connected to the working network, the threat actor gained unauthorised access to the developers drive and the companys shared drive that were both mapped to the compromised account.",
    "Crime development process stage description generated by the model": "The attacker gained unauthorized access to the organization's network using a compromised account, facilitated by the Remote Desktop Protocol (RDP) to connect to five servers within the AWS environment.",
    "Risk identified from Decision document": "The absence of strict access control enabled the attackers can use comprmised accounts to connet the working network and access to the drive stored personal data. ",
    "Risk identified by the model": "The organization's failure to implement MFA and enforce strict access controls reflects a significant gap in cybersecurity policy and governance. This lack of policy enforcement allowed the attacker to exploit the compromised account without additional verification layers.",
    "pattern": "Access Control Failures"
  },
  {
    "SN": 7,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "StyleZ",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "The Testing Database was stored in a publicly accessible directory in the Server without any access controls. This resulted in the Testing Database being directly accessible from the Internet and crawled and indexed by search engines.",
    "Crime development process stage description generated by the model": "The attacker gained access to the Testing Database because it was stored in a publicly accessible directory without any access controls, allowing direct access from the Internet.",
    "Risk identified from Decision document": "This failure to appreciate \nthe difference between anti-indexing and access control is a fundamental failing on the Organisations part. Proper authentication measures (e.g. password protection, access whitelisting) should have been implemented to control access to the Testing Database. ",
    "Risk identified by the model": "Did not implement proper access control and solely rely on anti-indexing function",
    "pattern": "Access Control Failures"
  },
  {
    "SN": 8,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "National Kidney Foundation",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "Employee A received a phishing email containing a hyperlink to a website with a further link to another website seeking his account credentials. The hacker is believed to have obtained Employee A's account credentials in this way. Thereafter, the hacker accessed Employee A's email account (the Email Account) and synchronised the mailbox.",
    "Crime development process stage description generated by the model": "The attacker gained access to the system by sending a phishing email to Employee A, which contained a hyperlink to a credential-harvesting website. Employee A clicked the link and entered his credentials, allowing the attacker to obtain them.",
    "Risk identified from Decision document": "The Organisation did not adopt a risk-based approach to identify employees whose roles and functions required them to handle sensitive personal data andstrengthen the access control measures to their email accounts. In relation to the email accounts of the employees who handle sensitive personal data (in particular, Employee A) in their daily work, the Organisation also did not implement more secure authentication processes access control measures to their email accounts prior to the Incident.",
    "Risk identified by the model": "The organization lacked robust email security policies and procedures to prevent phishing attacks. There was no enforced policy for MFA, which could have mitigated the risk of credential compromise. Additionally, there was likely a gap in monitoring and responding to suspicious email activities.",
    "pattern": "Access Control Failures"
  },
 {
    "SN": 9,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "Tokyo Century Leasing",
    "Crime Development Stage based on Crime Script Analysis Theory": "Instrumental Pre-condition",
    "Crime development process stage description identified from Decision document": "After gaining access to the system, the threat actor in turn compromised an administrator account and used it to execute a malicious encryption program on the servers.",
    "Crime development process stage description generated by the model": "The attacker executed a malicious encryption program named 'Stager.exe' on at least three servers using Remote Desktop Connections, leading to the encryption of personal data.",
    "Risk identified from Decision document": "The Organisation failed to implement MFA for its administrator accounts despite these accounts having access to confidential and sensitive personal data.",
    "Risk identified by the model": "The organization's failure to implement MFA for administrator accounts was a significant policy deficiency. This oversight in security policy allowed the attacker to exploit the compromised account fully, highlighting a gap in the organization's security governance.",
    "pattern": "Access Control Failures"
  },
  {
    "SN": 10,
    "APQC PCF ID": "20735 Develop and manage IT security, privacy, and data protection",
    "Situational Crime Prevention Technique": "Control access to facilities",
    "ISO/IEC 27002:2022 Clauses": "5.15: Access control",
    "Organisation": "Lovebonito",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "The Compromised Account allowed malicious actors to modify the checkout page to load and execute an unauthorised JavaScript code, allowing them to intercept data. It also allowed them to exfiltrate data from the Website via unauthorised Application Programming Interface (“API”) calls to Magento CMS.",
    "Crime development process stage description generated by the model": "The attacker exfiltrated credit card and order data from the website using unauthorized API calls to the Magento CMS, affecting the personal data of 5,561 customers.",
    "Risk identified from Decision document": "The Organisation’s system allowed insecure remote access, with no/limited system logging and no/limited system hardening; There was a lack of network ingress and egress filtering of the Organisation’s network to examine network traffic and There was improper access control in respect of Magento CMS. ",
    "Risk identified by the model": "The organization did not have adequate access control policies in place, allowing unauthorized API access. This reflects a failure in governance and policy enforcement, as well as a lack of comprehensive security monitoring to detect and respond to suspicious activity.",
    "pattern": "Access Control Failures"
  },
 {
    "SN": 11,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "Commeasure",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "Investigations revealed that the unknown threat actor(s) had most likely gained access and exfiltrated the Organisation's database of customer records hosted in an Amazon RDS cloud database, after they obtained an Amazon Web Services (AWS) access key. The AWS access key was embedded within an Android application package (the affected APK) publicly available for download from the Google Play Store.",
    "Crime development process stage description generated by the model": "The AWS access key embedded in the APK was a critical resource that enabled the attack.",
    "Risk identified from Decision document": "The AWS access key was embedded in the APK, and erroneously marked as a “test” key by the then-developers. With the exception of one of the Organisation’s co-founders and Chief Technology Officer, all the developers have since left the Organisation. Most unfortunately, even though the Organisation regarded this APK as “defunct”, the APK remained publicly available for download on the Google Play Store until  the Organisation became aware of the Incident and removed the affected APK..",
    "Risk identified by the model": "The Organisation's failure to implement a robust process for managing and reviewing access keys led to the key's exposure.",
    "pattern": "Authentication Deficiencies"
  }, 
  {
    "SN": 12,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "Consumers Assoication of Singpoare",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "The threat actor had successfully signed into the Affected Accounts using the correct login credentials.  It is likely that the correct login credentials were obtained from a successful phishing attack on an employee of the Organisation.  ",
    "Crime development process stage description generated by the model": "The attacker gained unauthorized access to the organization's email accounts, likely through a successful phishing attack on an employee.",
    "Risk identified from Decision document": "First, the Organisation did not enforce its own password policy.  The password for one of the Affected Accounts was “olse432”, which has 7 characters and would not have satisfied the Organisation’s Password Complexity Policy. Yet, this password was in use because the Organisation did not system-enforce its Password Complexity Policy requirements. Second, the Organisation admitted that it failed to adopt and enforce a policy on how frequently the passwords ought to be changed. The Affected Accounts were created in January 2019 and February 2019, and the passwords for both Affected Accounts had remained unchanged for almost 4 years prior to Incident 1.",
    "Risk identified by the model": "The organization failed to enforce its password management policy, allowing weak passwords that did not meet complexity requirements, and lacked a policy on password change frequency.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 13,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "Cortina Watch",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "It was determined that the Organisation had experienced multiple brute force attacks between 30 April to 4 June 2023. On 27 May 2023, a Virtual Private Network (VPN) account which the Organisation had been using to test VPN access to live environments was compromised.",
    "Crime development process stage description generated by the model": "The attacker gained access to the system by compromising a VPN account used for testing access to live environments. The lack of multi-factor authentication and the use of default account names facilitated this unauthorized access.",
    "Risk identified from Decision document": "Failed to enforce a strong password policy (by requiring a combination of alphanumeric characters in addition to its existing password policy of a minimum password length of 8 characters).The use of default account names makes it easier for a threat actor to target and mount an attack against these accounts.Implementing multi-factor authentication (MFA) for all VPN accounts, firewall access and access to files holding passwords. The Organisation admitted it could have but had neglected to do so.",
    "Risk identified by the model": "The organization failed to implement adequate access controls and did not enforce security policies that mandate the use of non-default account names and multi-factor authentication. This lack of governance and policy enforcement created an environment where technical vulnerabilities could be exploited.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 14,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "Farrer Park Hospital",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "In the present case, while MFA was eventually implemented for the marketing department's Office 365 work email accounts as an enhanced access control measure, this was unfortunately only after the Incident had occurred. Web-mail accounts are exposed to modes of attack that may defeat or circumvent 8-character alphanumeric password protection.",
    "Crime development process stage description generated by the model": "The attacker gained unauthorized access to two employees' Microsoft Office 365 email accounts, likely exploiting weak password protection.",
    "Risk identified from Decision document": "The strength of authentication, such as password requirements or other mechanisms for access to personal data, should depend on the potential damage to the individual (patinets).",
    "Risk identified by the model": "The organization's security posture was inadequate due to the absence of MFA, a critical security control. This gap was a result of insufficient risk assessment and failure to update security policies to include MFA as a standard practice.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 15,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "GenisU",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "The threat actor compromised one of its developer's password. This allowed the threat actor to enter the Organisation’s GitHub environment. ",
    "Crime development process stage description generated by the model": "The attacker gained unauthorized access to GeniusU Pte. Ltd.'s GitHub environment by compromising a developer's password, likely due to weak password practices.",
    "Risk identified from Decision document": "The Organisation's internal investigations revealed that the likely cause of the  Incident was compromise of one of its developer's password, either because the developer used a weak password for his GitHub account or the password for his GitHub account had been compromised.",
    "Risk identified by the model": "The organization failed to enforce strong password policies and multi-factor authentication, which are critical for protecting access to sensitive environments.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 16,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "Law Society of Singapore",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "Investigations disclosed that there could have been multiple threat actors targeting the Organisation or the same group of threat actors targeting the Organisation through multiple channels through brute force attacks, phishing email, and exploiting the unpatched VPN vulnerability of the VPN System.",
    "Crime development process stage description generated by the model": "The attacker gained unauthorized access to the organization's IT administrator account using a weak password that was susceptible to dictionary attacks. The password had not been changed for over 90 days, violating the organization's policy.",
    "Risk identified from Decision document": "Despite this password complying with the Organisations own password complexity rules, the Organisation acknowledged that this was a weak password and vulnerable to dictionary attacks due to the use of a full word and the Organisation's name. Further, the Organisation informed that the compromised admin account's password had been used for more than 90 days and had not been changed every 3 months, as required by the Organisation's password policy. ",
    "Risk identified by the model": "The organization's failure to enforce its password update policy and lack of oversight in ensuring compliance with security protocols contributed to the incident. Additionally, the absence of MFA for administrator access indicated a gap in security policy implementation.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 17,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "Lovebonito",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "One of the Organisations Magento CMS accounts with administrator privilegeswas likely to have been compromised. ",
    "Crime development process stage description generated by the model": "The attacker gained access to the system by compromising a Magento CMS account with administrator privileges. The account used a weak password, 'ilovebonito88', which included the organization's name, making it susceptible to brute force attacks.",
    "Risk identified from Decision document": "First, the Magento Password Policy did not mandate periodic changes of passwords as part of the default settings. Second, the default settings of the Magento Password Policy did not require the Organisation's employees to refrain from using easily-guessable passwords. ",
    "Risk identified by the model": "The organization failed to implement a strong password policy and did not enforce two-factor authentication (2FA), which was available but not activated. This reflects a lack of governance and oversight in ensuring that security features are utilized effectively. The absence of a comprehensive security policy allowed for weak passwords and inadequate access controls.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 18,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "MyRepublic",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "The disclosure of the Access Key in the Portal functionality which displayed technical information and The disclosure of the Access Key in the Portal's source code repository which was available to all the Organisation's developers, one of whom may have inadvertently disclosed the Access Key.",
    "Crime development process stage description generated by the model": "The attacker gained access to the system by exploiting a publicly accessible Amazon S3 Bucket. The Access Key required to access the Bucket was stored insecurely in the source code of the Portal, which facilitated unauthorized access.",
    "Risk identified from Decision document": "The Organisation should not have left the Access Key publicly accessible through the php-info URL. Instead, the Organisation could have disabled the PHP Info function or moved the Access Key from the Portal's system environment variables to configuration files available only to authorised parties.",
    "Risk identified by the model": "The organization failed to implement robust processes for managing sensitive credentials like the Access Key. There was a lack of governance and oversight in ensuring secure coding practices and access management, leading to the exposure of the Access Key.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 19,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "PPLingo",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "The PFE forensic investigations revealed that sometime between 26 April 2022 to 27 April 2022, the threat actor obtained the password of an administrator account of the Organisation's OPS System via brute force attacks. The password of the Compromised Admin Account was lingoace123. Using the Compromised Admin Account, the threat actor created several new accounts with administrator privileges to the OPS System, and used these newly created accounts to access the personal data of the Users.  ",
    "Crime development process stage description generated by the model": "The attacker gained access to the system through a brute force attack on an administrative account with a weak password that had not been changed for over two years.",
    "Risk identified from Decision document": "No expiry/requirment to change passwords. No requirments on password complexity. Guessable phrases/components in the password.",
    "Risk identified by the model": "The organization failed to implement a policy for regular password changes and did not enforce password complexity requirements. This lack of governance over password management practices allowed the use of weak passwords, which directly contributed to the vulnerability exploited by the attacker.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 20,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "RedMart",
    "Crime Development Stage based on Crime Script Analysis Theory": "Instrumental Pre-condition",
    "Crime development process stage description identified from Decision document": "The Threat Actor utilised the compromised GitHub user account to search through the GitHub Repositories and found the Chef key. Thereafter the TA used the Chef key to access the AWS Environment, whereupon he scanned through the Organisation's private S3 buckets and located the Hubot key.",
    "Crime development process stage description generated by the model": "The attacker discovered a high privilege access key (Chef key) hardcoded in the source code within GitHub repositories, accessible to a large group of developers.",
    "Risk identified from Decision document": "The Organisation did not implement sufficient access controls to protect and limit access to the Chef and Hubot keys, which enabled highly privileged access to various environments within the Organisation's system.",
    "Risk identified by the model": "The organization's failure to encrypt sensitive keys and conduct regular audits of key storage practices allowed the attacker to find and use the Hubot key. This reflects a gap in security governance and risk management.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 21,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "Sendtech",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "This AWS access key had not been rotated or changed since 2015. The Organisation suspected that the AWS could have been compromised through its former or current employees.",
    "Crime development process stage description generated by the model": "The attacker gained access to Sendtech's AWS account using a compromised access key that had not been rotated since its creation in 2015.",
    "Risk identified from Decision document": "The Organisation admitted it did not have specific AWS policies for the assignment of roles to rotate credentials. There was also a lack of detailed steps to manage credentials access of outgoing staff. Hence, the credentials were not rotated or changed whenever there are staff movement. ",
    "Risk identified by the model": "The organization lacked specific policies for credential management, particularly for rotating access keys and managing access for outgoing staff. This policy deficiency allowed the access key to remain unchanged for years, increasing the risk of compromise.",
    "pattern": "Authentication Deficiencies"
  },
  {
    "SN": 22,
    "APQC PCF ID": "20756 Manage IT user identity and authorization",
    "Situational Crime Prevention Technique": "Reduce anonymity",
    "ISO/IEC 27002:2022 Clauses": "5.17: Authentication information",
    "Organisation": "Tanah Merah Country Club",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "At the time of the Incident, the Employee was using the password TMCC@1234, which the Employee had not changed for a period of nearly 5 years, since 2016 to the time of the Incident on 22 February 2021. ",
    "Crime development process stage description generated by the model": "The attacker gained access to the system through a password spraying attack, exploiting the weak and unchanged password 'TMCC@1234' of an employee's email account.",
    "Risk identified from Decision document": "The Organisation failed to further develop its password requirements into a full-fledged password policy in writing and disseminate it in such a manner whereby all its employees, new and old, could easily take reference from the password policy and consult the password policy at any time.",
    "Risk identified by the model": "The organization had a domain password policy, but it was not effectively enforced due to a disruption in the domain controller. This failure in governance allowed the weak password to remain unchanged, highlighting a gap in policy implementation and monitoring.",
    "pattern": "Authentication Deficiencies"
  },
 
  {
    "SN": 23,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Century Evergreen",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": " The Organisation admitted that the Insecure Direct Object References (IDOR) vulnerability on its website, which allowed the complainant to manipulate the URL had existed from the time the website was launched on 9 November 2015",
    "Crime development process stage description generated by the model": "The attacker exploited an Insecure Direct Object References (IDOR) vulnerability in the company's website to gain unauthorized access to sensitive information.",
    "Risk identified from Decision document": "It failed to include any security requirements to protect personal data in its contract with the vendor who first developed and subsequently maintained the website.",
    "Risk identified by the model": "failed to include security requirements in its contract with the IT vendor, leading to a lack of security testing and oversight. This organizational oversight resulted in the prolonged existence of the vulnerability, as there were no processes in place to identify and mitigate such risks.",
    "pattern": "Supplier Management Risks"
  },
  {
    "SN": 24,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Future of Cooking",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "The cause of the data breach may be traced to a WordPress plugin (the Plugin) which was installed on the Website. The Plugin contained a bug which caused the File to be generated and uploaded on the Website's directory folder. ",
    "Crime development process stage description generated by the model": "The attacker gained access to the system through a bug in a WordPress plugin, which allowed a temporary file containing personal data to be publicly accessible.",
    "Risk identified from Decision document": "TFC did not specify any requirements for Hachi to implement any data protection measures to be implemented in the Website, whether in its contract with Hachi or other project documentation.",
    "Risk identified by the model": "TFC failed to implement adequate data protection measures and did not specify data protection requirements for Hachi in their contract. This lack of clear security policies and procedures led to the oversight of necessary security testing, allowing the vulnerability to exist.",
    "pattern": "Supplier Management Risks"
  },
  {
    "SN": 25,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "HMI",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "Investigations revealed that the Organisation did not follow up with the vendor to ensure that the Portal had been properly decommissioned, other than checking and confirming that the Portal was no longer accessible at its original URL address.  ",
    "Crime development process stage description generated by the model": "The organization decommissioned the Students Career Portal but failed to ensure the vendor properly completed the process, leaving an Excel file with personal data in the web directory without access controls.",
    "Risk identified from Decision document": "It did not have adequate policies and processes to exercise reasonable oversight over the vendor tasked with decommissioning the Portal. ",
    "Risk identified by the model": "The organization lacked sufficient policies and processes for vendor oversight, which led to the failure to verify the proper deletion of personal data. This gap in governance and process management was a fundamental cause of the breach.",
    "pattern": "Supplier Management Risks"
  },
  {
    "SN": 26,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Kingsforce Management Services",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "The Organisation subsequently engaged IT maintenance vendors in an effort to ensure the security of the website. However, maintenance had been ad-hoc and limited to troubleshooting functionality issues from bugs, glitches and/or when a page failed to load",
    "Crime development process stage description generated by the model": "The attacker exploited outdated website coding technology containing critical vulnerabilities to gain unauthorized access to Kingsforce's systems.",
    "Risk identified from Decision document": "The Organisation failed to provide sufficient clarity and specifications to its vendors on how to protect its database and personal data.",
    "Risk identified by the model": "The organization's failure to resolve contractual disputes with the website developer led to incomplete work on the website, leaving it vulnerable. This lack of resolution and oversight in contractual agreements directly contributed to the security breach.",
    "pattern": "Supplier Management Risks"
  },
  {
    "SN": 27,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Southaven Boutqiue",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "A threat actor had gained access to the Organisation's Point-Of-Sale (the POS) system server and encrypted the personal data of 4,709 customers.",
    "Crime development process stage description generated by the model": "The threat actor successfully infiltrated the company's Point-Of-Sale (POS) system server.",
    "Risk identified from Decision document": "The Organisation had failed to set out any data protection requirements or responsibilities with the POS vendor whom the Organisation had engaged to supply and install the POS, and relied on for system service issue. ",
    "Risk identified by the model": "Southaven Boutique's failure to conduct regular software updates and security reviews reflects a significant gap in their IT governance and risk management processes. The absence of a structured maintenance schedule and reliance on the vendor without clear responsibilities contributed to the system's vulnerability.",
    "pattern": "Supplier Management Risks"
  },
  {
    "SN": 28,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Tokyo Century Leasing",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "The software installed on the Device was the outdated version 6.0.4 of FortiOS and had a known vulnerability CVE-2018-13379 (Vulnerability).The effect of the Vulnerability was that a malicious actor could, via the internet, remotely access system files on the Device, specifically sslvpn_websession, containing the username and password of a VPN session. With such details, the malicious actor would be able to gain access to the VPN to which the target\u2019s (in this case, the Organisation) devices were connected;",
    "Crime development process stage description generated by the model": "The attacker gained access to the system through a vulnerability in the FortiGate 100E VPN and firewall device, which was running an outdated version of FortiOS (version 6.0.4) with a known vulnerability (CVE-2018-13379). This allowed the attacker to remotely access system files and compromise an administrator account.",
    "Risk identified from Decision document": "The Organisation failed to properly apply its mind to the issue of regular monitoring, as this was not contained in the contract between the Organisation and its IT vendor.",
    "Risk identified by the model": "The organization lacked a formal ICT policy for regular software patch management, relying instead on an ad-hoc approach with their IT vendor. This gap in governance and process led to the vulnerability remaining unpatched, as the organization assumed the vendor would handle updates without contractual obligation.",
    "pattern": "Supplier Management Risks"
  },
  {
    "SN": 29,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Trinity Christian Centre",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "Investigations by the Organisation revealed that the Organisation maintained an open and publicly exposed remote desktop protocol port. This allowed a threat actor with access to compromised administrator account credentials to enter the Organisation's network and database servers to execute ransomware attack.",
    "Crime development process stage description generated by the model": "The attacker gained access to the system through a publicly exposed RDP port using compromised administrator account credentials associated with an IT vendor.",
    "Risk identified from Decision document": "The Organisation admitted that its contract with its IT vendor only contained a general confidentiality clause not to disclose information obtained without the Organisation's prior written consent. Even though the Organisation was well aware that its IT vendor would process personal data, the Organisation failed to stipulate within the contract any requirements on the vendor to protect the church members' personal data,",
    "Risk identified by the model": "The organization failed to establish clear data protection requirements for the IT vendor, leading to a lack of oversight and security controls over vendor access. This gap in vendor management and security policy allowed the use of weak or compromised credentials without detection.",
    "pattern": "Supplier Management Risks"
  },
  {
    "SN": 30,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Vhive",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "The Organisation's forensic investigation results revealed that the Organisation's IT infrastructure had been outdated, with multiple vulnerabilities at the time of the Incident. The Organisation's e-commerce server ran on an outdated webserver service. This, together with an unpatched firewall, allowed the threat actor to remotely execute unauthorised code on the e-commerce server, and gained backdoor access to the e-commerce server to carry out the ransomware attack. ",
    "Crime development process stage description generated by the model": "The attacker gained access to Vhive's system through vulnerabilities in the IT infrastructure, specifically an outdated webserver service and an unpatched firewall.",
    "Risk identified from Decision document": "the Organisation's failure to ensure that there was a written contract with its IT vendor not only meant that there was a lack of clarity on the scope of work expected from the IT vendor, but also that the Organisation had failed to stipulate clear written security maintenance requirements and data protection requirements to its IT vendor to ensure the protection of personal data it was in control or in possession of.",
    "Risk identified by the model": "Vhive's lack of a formal contract with the IT vendor led to unclear responsibilities regarding security updates and maintenance. This organizational oversight resulted in the absence of a structured approach to managing IT security, contributing to the vulnerabilities being exploited.",
    "pattern": "Supplier Management Risks"
  },
  {
    "SN": 31,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Whiz Communications",
    "Crime Development Stage based on Crime Script Analysis Theory": "Pre-condition",
    "Crime development process stage description identified from Decision document": "The CMS from its initial design accepted any Python script requests that could be exploited for unauthorised exfiltration of customer personal data. This failure to block or manage scripts posed a data security risk and was a design flaw. By tracing web services and databased logs that Python scripts had indeed been used by the threat actor (“TA”)to extract .jpg files from the CMS. 29,903 attempts from 8 overseas IP addresses were made over 5 days in March and April 2023, with 24,323 successful extractions of the personal data of 24,323 individuals. ",
    "Crime development process stage description generated by the model": "The attacker gained access to the system by exploiting a design flaw in the CMS that allowed Python script requests.",
    "Risk identified from Decision document": "The organization failed to impose adequate security requirements on the CMS vendor, leading to the design flaw. This reflects a lack of robust vendor management and oversight processes, which are critical for ensuring third-party compliance with security standards.",
    "Risk identified by the model": "The organization failed to impose adequate security requirements on the CMS vendor, leading to the design flaw. This reflects a lack of robust vendor management and oversight processes, which are critical for ensuring third-party compliance with security standards.",
    "pattern": "Supplier Management Risks"
  },
    {
    "SN": 32,
    "APQC PCF ID": "20895 Define service support planning",
    "Situational Crime Prevention Technique": "Harden targets",
    "ISO/IEC 27002:2022 Clauses": "5.20: Addressing information security within supplier agreements",
    "Organisation": "Horizon Fast Ferry",
    "Crime Development Stage based on Crime Script Analysis Theory": "Entry",
    "Crime development process stage description identified from Decision document": "The Organisation admitted that the Incident occurred because valid credentials to its Ubuntu operating system root account (the “Root Account”), which is akin to a super-user account, had been misused to gain unauthorised access to the personal data in the Organisation’s possession and/or control. The Organisation admitted that the IT Supervisor’s lack of familiarity with the  Ubuntu operating system led the latter to mistakenly believe Contractor I’s claim that the Root Account was no longer active, and that the Contractors involved had only been able to login to the Organisation’s system through a different customer account. ",
    "Crime development process stage description generated by the model": "The termination of Contractor II and the absence of an IT vendor left the organization without adequate IT support, creating an environment where security oversight was more likely.",
    "Risk identified from Decision document": "The Organisation admitted that even though it relied on the IT Support Vendor to provide IT support and to act on its behalf when liaising with external vendors such as the Contractors involved, the Organisation failed to define and capture the job scope, responsibilities and competencies required of key personnel through a formal contractual agreement with the IT Support Vendor.",
    "Risk identified by the model": "The lack of an IT vendor after the termination of Contractor II left the organization without necessary IT support, increasing the risk of security oversights and delayed responses to potential threats.",
    "pattern": "Supplier Management Risks"
  }
];
        let filteredData = [];
        let charts = {};
        let stageMapping = {};

        // Chart default font configuration
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", sans-serif';
        Chart.defaults.font.size = 14;
        Chart.defaults.font.weight = '500';
        Chart.defaults.color = '#374151';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard initializing...');
            
            // Security: Validate and sanitize data
            const validatedData = validateData(rawData);
            filteredData = [...validatedData];
            
            // Set generated date
            document.getElementById('generatedDate').textContent = new Date().toLocaleString();
            
            initializePatternInfo();
            initializeFilters();
            updateMetrics();
            createCharts();
            updatePatternTables();
            setPatternDescriptions();
            setupEventListeners();
            
            console.log('Dashboard initialization complete');
        });
        
        function initializePatternInfo() {
            // Calculate pattern counts
            const patternCounts = {};
            filteredData.forEach(item => {
                const pattern = item.pattern || '';
                if (pattern) {
                    patternCounts[pattern] = (patternCounts[pattern] || 0) + 1;
                }
            });
            
            // Sort patterns by count
            const sortedPatterns = Object.entries(patternCounts).sort((a, b) => b[1] - a[1]);
            
            // Generate pattern summary in header
            const patternSummaryEl = document.getElementById('patternSummary');
            patternSummaryEl.innerHTML = '';
            
            sortedPatterns.forEach(([patternName, count], index) => {
                if (PATTERN_COLORS[patternName]) {
                    const info = PATTERN_COLORS[patternName];
                    const patternItem = document.createElement('div');
                    patternItem.className = `pattern-item pattern-${index + 1}`;
                    patternItem.innerHTML = `
                        <div class="pattern-dot" style="background-color: ${info.color};"></div>
                        <div>
                            <div class="pattern-name">${sanitizeHTML(patternName)} (${count} records)</div>
                            <div class="pattern-desc">${sanitizeHTML(info.desc)}</div>
                        </div>
                    `;
                    patternSummaryEl.appendChild(patternItem);
                }
            });
            
            // Generate navigation tabs
            const navTabsEl = document.getElementById('navTabs');
            navTabsEl.innerHTML = '';
            
            // Add overview tab
            const overviewTab = document.createElement('button');
            overviewTab.className = 'nav-tab active';
            overviewTab.textContent = 'Pattern Overview';
            overviewTab.onclick = () => showView('overview');
            navTabsEl.appendChild(overviewTab);
            
            // Add pattern tabs
            sortedPatterns.forEach(([patternName]) => {
                if (PATTERN_COLORS[patternName]) {
                    const tab = document.createElement('button');
                    tab.className = 'nav-tab';
                    tab.textContent = patternName;
                    tab.onclick = () => showView(patternName.toLowerCase().replace(/ /g, '-'));
                    navTabsEl.appendChild(tab);
                }
            });
            
            // Generate pattern content sections
            const patternContentsEl = document.getElementById('patternContents');
            patternContentsEl.innerHTML = '';
            
            sortedPatterns.forEach(([patternName]) => {
                if (PATTERN_COLORS[patternName]) {
                    const info = PATTERN_COLORS[patternName];
                    const contentSection = document.createElement('div');
                    contentSection.id = `${patternName.toLowerCase().replace(/ /g, '-')}Content`;
                    contentSection.className = 'content hidden';
                    contentSection.innerHTML = `
                        <h3>${sanitizeHTML(patternName)} Analysis (<span id="${patternName.toLowerCase().replace(/ /g, '-')}Count">0</span> records)</h3>
                        <p style="margin-bottom: 10px; color: #4b5563; font-size: 15px; font-weight: 500;" id="${patternName.toLowerCase().replace(/ /g, '-')}Pattern"></p>
                        <p style="margin-bottom: 20px; color: #6b7280; font-size: 14px;">
                            Analysis of security incidents related to ${sanitizeHTML(info.desc.toLowerCase())}.
                        </p>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th style="width: 260px;">Organisation</th>
                                        <th style="width: 260px;">Crime script stage</th>
                                        <th style="min-width: 800px; max-width: 800px;">Crime development process</th>
                                        <th style="min-width: 700px; max-width: 700px;">Risk description</th>
                                    </tr>
                                </thead>
                                <tbody id="${patternName.toLowerCase().replace(/ /g, '-')}TableBody">
                                </tbody>
                            </table>
                        </div>
                    `;
                    patternContentsEl.appendChild(contentSection);
                }
            });
        }

        function setPatternDescriptions() {
            const patternDescriptions = {
                'Authentication Deficiencies': 'PCF 20756 Manage IT user identity and authorization - SCP Reduce anonymity - ISO 5.17 Authentication information',
                'Supplier Management Risks': 'PCF 20895 Define service support planning - SCP Harden targets - ISO 5.20 Addressing information security within supplier agreements',
                'Access Control Failures': 'PCF 20735 Develop and manage IT security, privacy, and data protection - SCP Control access to facilities - ISO 5.15 Access control'
            };
            
            Object.entries(patternDescriptions).forEach(([pattern, description]) => {
                const elementId = pattern.toLowerCase().replace(/ /g, '-') + 'Pattern';
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = description;
                }
            });
        }

        function initializeFilters() {
            const stages = [...new Set(filteredData.map(item => item['Crime Development Stage based on Crime Script Analysis Theory']).filter(Boolean))];
            const isoControls = [...new Set(filteredData.map(item => item['ISO/IEC 27002:2022 Clauses']).filter(Boolean))];
            const scpTechniques = [...new Set(filteredData.map(item => item['Situational Crime Prevention Technique']).filter(Boolean))];
            const apqcIds = [...new Set(filteredData.map(item => item['APQC PCF ID']).filter(Boolean))];

            populateSelect('stageFilter', stages.sort());
            populateSelect('isoFilter', isoControls.sort());
            populateSelect('scpFilter', scpTechniques.sort());
            populateSelect('apqcFilter', apqcIds.sort());
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        function setupEventListeners() {
            document.getElementById('apqcFilter').addEventListener('change', filterData);
            document.getElementById('stageFilter').addEventListener('change', filterData);
            document.getElementById('isoFilter').addEventListener('change', filterData);
            document.getElementById('scpFilter').addEventListener('change', filterData);
            document.getElementById('resetFilters').addEventListener('click', resetFilters);
        }

        function filterData() {
            const apqcFilter = document.getElementById('apqcFilter').value;
            const stageFilter = document.getElementById('stageFilter').value;
            const isoFilter = document.getElementById('isoFilter').value;
            const scpFilter = document.getElementById('scpFilter').value;

            // Security: Use validated raw data for filtering
            const validatedData = validateData(rawData);
            filteredData = validatedData.filter(item => {
                const matchesApqc = apqcFilter === 'all' || 
                    item['APQC PCF ID'] === apqcFilter;
                
                const matchesStage = stageFilter === 'all' || 
                    item['Crime Development Stage based on Crime Script Analysis Theory'] === stageFilter;
                
                const matchesIso = isoFilter === 'all' || 
                    item['ISO/IEC 27002:2022 Clauses'] === isoFilter;
                
                const matchesScp = scpFilter === 'all' || 
                    item['Situational Crime Prevention Technique'] === scpFilter;

                return matchesApqc && matchesStage && matchesIso && matchesScp;
            });

            updateMetrics();
            updateCharts();
            updatePatternTables();
        }

        function resetFilters() {
            document.getElementById('apqcFilter').value = 'all';
            document.getElementById('stageFilter').value = 'all';
            document.getElementById('isoFilter').value = 'all';
            document.getElementById('scpFilter').value = 'all';
            
            // Security: Re-validate data
            const validatedData = validateData(rawData);
            filteredData = [...validatedData];
            
            updateMetrics();
            updateCharts();
            updatePatternTables();
        }

        function updateMetrics() {
            document.getElementById('totalIncidents').textContent = filteredData.length;

            const noFilter = 
                document.getElementById('apqcFilter').value === 'all' &&
                document.getElementById('stageFilter').value === 'all' &&
                document.getElementById('isoFilter').value === 'all' &&
                document.getElementById('scpFilter').value === 'all';
            const uniqueOrgCount = new Set(filteredData.map(item => item.Organisation)).size;
            document.getElementById('totalOrgs').textContent = noFilter
                ? Math.max(0, uniqueOrgCount)
                : uniqueOrgCount;
            
            const entryStageCount = filteredData.filter(item => 
                item['Crime Development Stage based on Crime Script Analysis Theory'] === 'Entry'
            ).length;
            document.getElementById('entryStageCount').textContent = entryStageCount;
            
            const entryPercent = filteredData.length > 0 ? ((entryStageCount / filteredData.length) * 100).toFixed(1) : 0;
            document.getElementById('entryStagePercent').textContent = `${entryPercent}% of total`;
            
            // Get pattern counts and find the primary pattern
            const patternCounts = {};
            filteredData.forEach(item => {
                const pattern = item.pattern || 'Unknown';
                patternCounts[pattern] = (patternCounts[pattern] || 0) + 1;
            });
            
            const sortedPatterns = Object.entries(patternCounts).sort((a, b) => b[1] - a[1]);
            if (sortedPatterns.length > 0) {
                const [primaryPattern, primaryCount] = sortedPatterns[0];
                const primaryPercent = filteredData.length > 0 ? ((primaryCount / filteredData.length) * 100).toFixed(1) : 0;
                document.getElementById('primaryPatternName').textContent = primaryPattern;
                document.getElementById('primaryPatternCount').textContent = `${primaryCount} cases (${primaryPercent}%)`;
            }
        }

        function createCharts() {
            // Patterns Chart - Use consistent colors
            const patternCounts = countByField('pattern');
            const patternLabels = Object.keys(patternCounts);
            const patternColors = patternLabels.map(label => PATTERN_COLORS[label]?.color || '#999999');
            
            charts.patterns = new Chart(document.getElementById('patternsChart'), {
                type: 'doughnut',
                data: {
                    labels: patternLabels,
                    datasets: [{
                        data: Object.values(patternCounts),
                        backgroundColor: patternColors,
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverBorderWidth: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 25,
                                usePointStyle: true,
                                font: { 
                                    size: 15,
                                    weight: '600'
                                },
                                boxWidth: 18,
                                boxHeight: 18
                            }
                        },
                        tooltip: {
                            titleFont: { 
                                size: 16,
                                weight: '600'
                            },
                            bodyFont: { 
                                size: 14,
                                weight: '500'
                            },
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} cases (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Crime Script Stages Chart with improved hover
            const stageCounts = countByField('Crime Development Stage based on Crime Script Analysis Theory');
            const stageLabels = Object.keys(stageCounts);
            
            // Define fixed stage-to-color mapping
            const stageColorMapping = {
                'Preparation': '#ff6b6b',
                'Entry': '#4ecdc4', 
                'Pre-condition': '#99f7c1',
                'Instrumental Pre-condition': '#45b7d1',
                'Instrumental Initiation': '#feca57',
                'Instrumental Actualization': '#ff9ff3',
                'Doing': '#54a0ff',
                'Post-condition': '#5f27cd',
                'Exit': '#00d2d3',
                'Other': '#96ceb4'
            };
            
            // Get colors for current stages based on stage names
            const stageColors = stageLabels.map(stage => stageColorMapping[stage] || '#cccccc');
            
            // Store stage mapping for hover
            stageLabels.forEach((label, index) => {
                stageMapping[index] = label;
            });
            
            charts.stages = new Chart(document.getElementById('stagesChart'), {
                type: 'bar',
                data: {
                    labels: stageLabels.map((_, index) => index + 1),
                    datasets: [{
                        label: 'Crime Script Stages',
                        data: Object.values(stageCounts),
                        backgroundColor: stageColors,
                        borderColor: stageColors.map(color => color + 'CC'),
                        borderWidth: 2,
                        borderRadius: 6,
                        borderSkipped: false,
                        hoverBackgroundColor: stageColors.map(color => color + 'DD'),
                        hoverBorderColor: stageColors,
                        hoverBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    layout: {
                        padding: {
                            left: 25,
                            right: 25,
                            top: 25,
                            bottom: 25
                        }
                    },
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'bottom',
                            labels: {
                                generateLabels: function(chart) {
                                    return stageLabels.map((label, index) => ({
                                        text: label,
                                        fillStyle: stageColorMapping[label] || '#cccccc',
                                        strokeStyle: stageColorMapping[label] || '#cccccc',
                                        lineWidth: 2,
                                        fontColor: '#374151',
                                        fontStyle: 'normal',
                                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", sans-serif',
                                        fontSize: 13,
                                        datasetIndex: 0,
                                        index: index
                                    }));
                                },
                                padding: 20,
                                usePointStyle: true,
                                boxWidth: 15,
                                boxHeight: 15,
                                font: { 
                                    size: 13,
                                    weight: '500'
                                }
                            }
                        },
                        tooltip: {
                            enabled: true,
                            titleFont: { 
                                size: 16,
                                weight: '600'
                            },
                            bodyFont: { 
                                size: 14,
                                weight: '500'
                            },
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                title: function(context) {
                                    return stageMapping[context[0].dataIndex] || stageLabels[context[0].dataIndex];
                                },
                                label: function(context) {
                                    const stageTotal = Object.values(stageCounts).reduce((a, b) => a + b, 0);
                                    const percentage = stageTotal > 0 ? ((context.parsed.y / stageTotal) * 100).toFixed(1) : 0;
                                    const stageName = stageMapping[context.dataIndex] || stageLabels[context.dataIndex];
                                    return `${stageName}: ${context.parsed.y} cases (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            beginAtZero: true, 
                            ticks: { 
                                stepSize: 1,
                                font: { 
                                    size: 16,
                                    weight: '600'
                                },
                                color: '#374151'
                            },
                            title: {
                                display: true,
                                text: 'Number of Cases',
                                font: { 
                                    size: 18,
                                    weight: '700'
                                },
                                color: '#1f2937'
                            },
                            grid: {
                                color: '#e5e7eb'
                            }
                        },
                        x: { 
                            ticks: { 
                                font: { 
                                    size: 16,
                                    weight: '600'
                                },
                                color: '#374151'
                            },
                            
                            grid: {
                                display: false
                            }
                        }
                    },
                    onHover: (event, activeElements) => {
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                    }
                }
            });

            // ISO Organizational Controls Chart
            const isoCounts = countByField('ISO/IEC 27002:2022 Clauses');
            const isoScpMapping = getIsoScpMapping();
            const isoLabels = Object.keys(isoCounts);
            const isoColors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];
            
            charts.iso = new Chart(document.getElementById('isoChart'), {
                type: 'bar',
                data: {
                    labels: ['1', '2', '3'],
                    datasets: [{
                        label: 'ISO Controls',
                        data: Object.values(isoCounts),
                        backgroundColor: isoColors.slice(0, isoLabels.length),
                        borderColor: isoColors.slice(0, isoLabels.length),
                        borderWidth: 2,
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 25,
                            right: 25,
                            top: 25,
                            bottom: 25
                        }
                    },
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'bottom',
                            labels: {
                                generateLabels: function(chart) {
                                    return isoLabels.map((label, index) => ({
                                        text: label,
                                        fillStyle: isoColors[index],
                                        strokeStyle: isoColors[index],
                                        lineWidth: 0,
                                        hidden: false,
                                        index: index
                                    }));
                                },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'rect',
                                font: { 
                                    size: 13,
                                    weight: '500'
                                }
                            }
                        },
                        tooltip: {
                            titleFont: { 
                                size: 16,
                                weight: '600'
                            },
                            bodyFont: { 
                                size: 14,
                                weight: '500'
                            },
                            padding: 12,
                            callbacks: {
                                title: function(context) {
                                    return isoLabels[context[0].dataIndex];
                                },
                                label: function(context) {
                                    const isoTotal = Object.values(isoCounts).reduce((a, b) => a + b, 0);
                                    const percentage = isoTotal > 0 ? ((context.parsed.y / isoTotal) * 100).toFixed(1) : 0;
                                    return `Cases: ${context.parsed.y} (${percentage}%)`;
                                },
                                afterLabel: function(context) {
                                    const originalLabel = isoLabels[context.dataIndex];
                                    const scpTechniques = isoScpMapping[originalLabel] || [];
                                    if (scpTechniques.length > 0) {
                                        return [``, `Associated SCP Techniques:`, ...scpTechniques.map(tech => `• ${tech}`)];
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            beginAtZero: true,
                            ticks: { 
                                stepSize: 1,
                                font: { 
                                    size: 16,
                                    weight: '600'
                                },
                                color: '#374151'
                            },
                            title: {
                                display: true,
                                text: 'Number of Cases',
                                font: { 
                                    size: 18,
                                    weight: '700'
                                },
                                color: '#1f2937'
                            },
                            grid: {
                                color: '#e5e7eb'
                            }
                        },
                        x: { 
                            ticks: { 
                                font: { 
                                    size: 16,
                                    weight: '600'
                                },
                                color: '#374151'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // APQC PCF Process Categories Chart
            const apqcCounts = countByField('APQC PCF ID');
            const apqcLabels = Object.keys(apqcCounts);
            const apqcColors = [
                '#8e44ad', '#27ae60', '#f39c12', '#e74c3c', '#3498db',
                '#1abc9c', '#2c3e50', '#d35400', '#7f8c8d', '#f1c40f'
            ];
            
            charts.apqc = new Chart(document.getElementById('apqcChart'), {
                type: 'bar',
                data: {
                    labels: apqcLabels.map((_, index) => index + 1),
                    datasets: [{
                        label: 'APQC Process',
                        data: Object.values(apqcCounts),
                        backgroundColor: apqcColors.slice(0, apqcLabels.length),
                        borderColor: apqcColors.slice(0, apqcLabels.length).map(color => color + 'CC'),
                        borderWidth: 2,
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 25,
                            right: 25,
                            top: 25,
                            bottom: 25
                        }
                    },
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'bottom',
                            labels: {
                                generateLabels: function(chart) {
                                    return apqcLabels.map((label, index) => ({
                                        text: label,
                                        fillStyle: apqcColors[index],
                                        strokeStyle: apqcColors[index],
                                        lineWidth: 2,
                                        fontColor: '#374151',
                                        fontStyle: 'normal',
                                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", sans-serif',
                                        fontSize: 13,
                                        datasetIndex: 0,
                                        index: index
                                    }));
                                },
                                padding: 20,
                                usePointStyle: true,
                                boxWidth: 15,
                                boxHeight: 15,
                                font: { 
                                    size: 13,
                                    weight: '500'
                                }
                            }
                        },
                        tooltip: {
                            titleFont: { 
                                size: 16,
                                weight: '600'
                            },
                            bodyFont: { 
                                size: 14,
                                weight: '500'
                            },
                            padding: 12,
                            callbacks: {
                                title: function(context) {
                                    return apqcLabels[context[0].dataIndex];
                                },
                                label: function(context) {
                                    const apqcTotal = Object.values(apqcCounts).reduce((a, b) => a + b, 0);
                                    const percentage = apqcTotal > 0 ? ((context.parsed.y / apqcTotal) * 100).toFixed(1) : 0;
                                    return `${apqcLabels[context.dataIndex]}: ${context.parsed.y} cases (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            beginAtZero: true,
                            ticks: { 
                                stepSize: 1,
                                font: { 
                                    size: 16,
                                    weight: '600'
                                },
                                color: '#374151'
                            },
                            title: {
                                display: true,
                                text: 'Number of Cases',
                                font: { 
                                    size: 18,
                                    weight: '700'
                                },
                                color: '#1f2937'
                            },
                            grid: {
                                color: '#e5e7eb'
                            }
                        },
                        x: { 
                            ticks: { 
                                font: { 
                                    size: 16,
                                    weight: '600'
                                },
                                color: '#374151'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            // Update patterns chart with consistent colors
            const patternCounts = countByField('pattern');
            const patternLabels = Object.keys(patternCounts);
            const patternColors = patternLabels.map(label => PATTERN_COLORS[label]?.color || '#999999');
            
            charts.patterns.data.labels = patternLabels;
            charts.patterns.data.datasets[0].data = Object.values(patternCounts);
            charts.patterns.data.datasets[0].backgroundColor = patternColors;
            charts.patterns.update();

            // Update other charts...
            updateStagesChart();
            updateIsoChart();
            updateApqcChart();
        }

        function updateStagesChart() {
            const stageCounts = countByField('Crime Development Stage based on Crime Script Analysis Theory');
            const stageLabels = Object.keys(stageCounts);
            const stageData = Object.values(stageCounts);  
            
            // Define fixed stage-to-color mapping (same as in createCharts)
            const stageColorMapping = {
                'Preparation': '#ff6b6b',
                'Entry': '#4ecdc4', 
                'Pre-condition': '#99f7c1',
                'Instrumental Pre-condition': '#45b7d1',
                'Instrumental initiation': '#feca57',
                'Instrumental actualization': '#ff9ff3',
                'Doing': '#54a0ff',
                'Post-condition': '#5f27cd',
                'Exit': '#00d2d3',
                'Other': '#96ceb4'
            };
            
            // Get colors for current stages based on stage names
            const stageColors = stageLabels.map(stage => stageColorMapping[stage] || '#cccccc');
            
            // Update stage mapping
            stageMapping = {};
            stageLabels.forEach((label, index) => {
                stageMapping[index] = label;
            });
            
            // Clear and rebuild chart data
            charts.stages.data.labels = stageLabels.map((_, index) => index + 1);
            charts.stages.data.datasets[0].data = stageData; 
            charts.stages.data.datasets[0].backgroundColor = stageColors;
            charts.stages.data.datasets[0].borderColor = stageColors.map(color => color + 'CC');
            charts.stages.data.datasets[0].hoverBackgroundColor = stageColors.map(color => color + 'DD'); 
            charts.stages.data.datasets[0].hoverBorderColor = stageColors; 
            
            // Update legend to use fixed color mapping
            charts.stages.options.plugins.legend.labels.generateLabels = function(chart) {
                return stageLabels.map((label, index) => ({
                    text: label,
                    fillStyle: stageColorMapping[label] || '#cccccc', 
                    strokeStyle: stageColorMapping[label] || '#cccccc', 
                    lineWidth: 2,
                    fontColor: '#374151',
                    fontStyle: 'normal',
                    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", sans-serif',
                    fontSize: 13,
                    datasetIndex: 0,
                    index: index
                }));
            };
            
            // Force chart update
            charts.stages.update('none'); 
        }

        function updateIsoChart() {
            const isoCounts = countByField('ISO/IEC 27002:2022 Clauses');
            const isoLabels = Object.keys(isoCounts);
            const isoColors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];
            
            charts.iso.data.labels = ['1', '2', '3'];
            charts.iso.data.datasets[0].data = Object.values(isoCounts);
            charts.iso.data.datasets[0].backgroundColor = isoColors.slice(0, isoLabels.length);
            charts.iso.data.datasets[0].borderColor = isoColors.slice(0, isoLabels.length);
            charts.iso.update();
        }

        function updateApqcChart() {
            const apqcCounts = countByField('APQC PCF ID');
            const apqcLabels = Object.keys(apqcCounts);
            const apqcColors = [
                '#8e44ad', '#27ae60', '#f39c12', '#e74c3c', '#3498db',
                '#1abc9c', '#2c3e50', '#d35400', '#7f8c8d', '#f1c40f'
            ];
            
            charts.apqc.data.labels = apqcLabels.map((_, index) => index + 1);
            charts.apqc.data.datasets[0].data = Object.values(apqcCounts);
            charts.apqc.data.datasets[0].backgroundColor = apqcColors.slice(0, apqcLabels.length);
            charts.apqc.data.datasets[0].borderColor = apqcColors.slice(0, apqcLabels.length).map(color => color + 'CC');
            charts.apqc.update();
        }

        function countByField(fieldName) {
            const counts = {};
            filteredData.forEach(item => {
                const value = item[fieldName];
                if (value !== null && value !== undefined && value !== 'NA') {
                    const stringValue = value.toString().trim();
                    if (stringValue !== '') {
                        counts[stringValue] = (counts[stringValue] || 0) + 1;
                    }
                }
            });
            return counts;
        }

        function getIsoScpMapping() {
            const mapping = {};
            filteredData.forEach(item => {
                const isoControl = item['ISO/IEC 27002:2022 Clauses'];
                const scpTechnique = item['Situational Crime Prevention Technique'];
                if (isoControl && scpTechnique) {
                    if (!mapping[isoControl]) {
                        mapping[isoControl] = new Set();
                    }
                    mapping[isoControl].add(scpTechnique);
                }
            });
            
            Object.keys(mapping).forEach(key => {
                mapping[key] = Array.from(mapping[key]);
            });
            
            return mapping;
        }

        function updatePatternTables() {
            console.log('updatePatternTables called with', filteredData.length, 'filtered records');
            
            // Update all pattern tables
            Object.keys(PATTERN_COLORS).forEach(patternName => {
                updatePatternTable(patternName);
            });
        }
        
        function updatePatternTable(patternName) {
            console.log(`Updating ${patternName} table...`);
            
            if (!filteredData || filteredData.length === 0) {
                console.log('No filtered data available');
                return;
            }
            
            const patternData = filteredData.filter(item => {
                const pattern = item.pattern || '';
                return pattern === patternName;
            });
            
            console.log(`${patternName} filtered data:`, patternData.length, 'records');
            
            const tableId = patternName.toLowerCase().replace(/ /g, '-') + 'TableBody';
            const tbody = document.getElementById(tableId);
            const countId = patternName.toLowerCase().replace(/ /g, '-') + 'Count';
            
            if (!tbody) {
                console.error(`${patternName} table body not found!`);
                return;
            }
            
            tbody.innerHTML = '';
            document.getElementById(countId).textContent = patternData.length;
            
            if (patternData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center; padding: 20px; color: #6b7280;">No ${patternName} records found</td>`;
                tbody.appendChild(row);
                return;
            }
            
            patternData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const organization = item['Organisation'] || 'N/A';
                const crimeStage = item['Crime Development Stage based on Crime Script Analysis Theory'] || 'N/A';
                const actualEvent = item['Crime development process stage description identified from Decision document'] || 'N/A';
                const actualRisk = item['Risk identified from Decision document'] || 'N/A';

                row.innerHTML = `
                    <td class="org-cell">${organization}</td>
                    <td class="stage-cell">${crimeStage}</td>
                    <td class="event-cell">${actualEvent}</td>
                    <td class="risk-cell">${actualRisk}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            console.log(`${patternName} table updated with`, tbody.children.length, 'rows');
        }

        function showView(viewName) {
            console.log('showView called with:', viewName);
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active class to clicked tab
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // Hide all content sections
            document.querySelectorAll('.content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected content section
            let targetSectionId = '';
            if (viewName === 'overview') {
                targetSectionId = 'overviewContent';
            } else {
                targetSectionId = viewName + 'Content';
                // Update the specific pattern table when showing its view
                const patternName = Object.keys(PATTERN_COLORS).find(key => 
                    key.toLowerCase().replace(/ /g, '-') === viewName
                );
                if (patternName) {
                    updatePatternTable(patternName);
                }
            }
            
            const targetSection = document.getElementById(targetSectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                console.log('Showing section:', targetSectionId);
            } else {
                console.error('Target section not found:', targetSectionId);
            }
        }

        // Security: Prevent console access in production
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            console.log = console.warn = console.error = function() {};
        }
    </script>
</body>
</html>